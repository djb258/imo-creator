name: Deep Wiki Validation
on: [push, pull_request]

jobs:
  validate-wiki:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: npm install ajv-cli -g
        
      - name: Validate branch specifications
        run: |
          if [ -d "docs/branches" ]; then
            ajv validate -s docs/branches/schema.json -d "docs/branches/*.yml" --spec=draft7 || exit 1
            echo "‚úÖ Branch specifications are valid"
          else
            echo "‚ÑπÔ∏è No branch specifications to validate"
          fi
          
      - name: Generate wiki
        run: |
          if [ -f "scripts/gen-wiki.mjs" ]; then
            node scripts/gen-wiki.mjs
            echo "‚úÖ Wiki generation successful"
          else
            echo "‚ÑπÔ∏è No wiki generator found"
          fi
          
      - name: Check wiki completeness
        run: |
          if [ -d "docs/wiki" ]; then
            echo "üìö Wiki sections found:"
            ls -la docs/wiki/
            if [ -d "docs/wiki/branches" ]; then
              echo "üå≤ Branch documentation:"
              ls -la docs/wiki/branches/
            fi
          fi
