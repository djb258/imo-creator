%% CTB Role-Based System Map (Mermaid Diagram)
%% Version: 1.3.0
%% Last Updated: 2025-10-23

graph TB
    subgraph "20k Altitude - Orchestration Layer"
        AI[AI Engine<br/>gemini]
        IB[Integration Bridge<br/>composio-mcp]
    end

    subgraph "5k Altitude - Data Layer"
        WB[Workbench DB<br/>firebase]
        VD[Vault DB<br/>neon]
    end

    %% Data Flow Links
    AI -->|orchestration| WB
    WB -->|promotion<br/>gatekeeper| VD
    IB -->|data_bridge| VD
    IB -->|tool_driver| AI
    AI -->|tool_request| IB
    WB -->|feedback_loop| AI

    %% Styling
    classDef engine fill:#FFD700,stroke:#333,stroke-width:2px,color:#000
    classDef workbench fill:#4169E1,stroke:#333,stroke-width:2px,color:#FFF
    classDef vault fill:#20B2AA,stroke:#333,stroke-width:2px,color:#FFF
    classDef bridge fill:#FF8C00,stroke:#333,stroke-width:2px,color:#000

    class AI engine
    class WB workbench
    class VD vault
    class IB bridge

    %% Notes
    note1[AI Engine: Reasoning & Orchestration]
    note2[Workbench DB: Staging & Validation]
    note3[Vault DB: Production Storage]
    note4[Integration Bridge: External Tools]

    %% Barton Doctrine Enforcement
    style AI fill:#FFD700
    style WB fill:#4169E1
    style VD fill:#20B2AA
    style IB fill:#FF8C00

%% Legend
%% Yellow (AI Engine): 20k altitude, orchestration layer
%% Blue (Workbench DB): 5k altitude, staging memory
%% Teal (Vault DB): 5k altitude, production vault
%% Orange (Integration Bridge): 20k altitude, external integrations
