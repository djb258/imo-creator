{
  "plan_id": "clients_intake",
  "version": "1.0.0",
  "description": "Client intake processing with altitude-based orchestration",
  "stages": [
    {
      "stage_id": "A1",
      "altitude": 30000,
      "orchestrator": "overall-orchestrator",
      "steps": [
        {
          "step_id": "route_to_input",
          "agent_id": "overall-orchestrator",
          "action": "route",
          "args": {
            "target": "input",
            "reason": "New client intake requires input processing"
          }
        }
      ]
    },
    {
      "stage_id": "B1",
      "altitude": 20000,
      "orchestrator": "input-orchestrator",
      "steps": [
        {
          "step_id": "map_input",
          "agent_id": "input-subagent-mapper",
          "action": "map",
          "args": {
            "source_schema": "raw_intake",
            "target_schema": "normalized_client"
          },
          "timeout": 30000
        },
        {
          "step_id": "validate_input",
          "agent_id": "input-subagent-validator",
          "action": "validate",
          "args": {
            "schema": "client_intake_v1",
            "strict": true
          },
          "timeout": 20000
        }
      ]
    },
    {
      "stage_id": "C1",
      "altitude": 10000,
      "orchestrator": "middle-orchestrator",
      "steps": [
        {
          "step_id": "db_plan",
          "agent_id": "middle-subagent-db",
          "action": "plan",
          "args": {
            "mode": "dry_run",
            "operations": ["insert_client", "update_relations"]
          },
          "timeout": 45000
        },
        {
          "step_id": "enforce_rules",
          "agent_id": "middle-subagent-enforcer",
          "action": "enforce",
          "args": {
            "rules": ["duplicate_check", "compliance_validation", "credit_check"],
            "enforcement_level": "strict"
          },
          "timeout": 30000
        }
      ]
    },
    {
      "stage_id": "C2",
      "altitude": 10000,
      "orchestrator": "middle-orchestrator",
      "steps": [
        {
          "step_id": "db_apply",
          "agent_id": "middle-subagent-db",
          "action": "apply",
          "args": {
            "mode": "commit",
            "rollback_on_error": true
          },
          "when": "promotion.decision == 'PROMOTE'",
          "on_error": "retry",
          "retry_count": 2,
          "timeout": 60000
        }
      ]
    },
    {
      "stage_id": "D1",
      "altitude": 5000,
      "orchestrator": "output-orchestrator",
      "steps": [
        {
          "step_id": "notify_stakeholders",
          "agent_id": "output-subagent-notifier",
          "action": "notify",
          "args": {
            "channels": ["email", "slack"],
            "template": "client_intake_complete",
            "recipients": ["sales_team", "account_managers"]
          },
          "timeout": 15000
        },
        {
          "step_id": "generate_report",
          "agent_id": "output-subagent-reporter",
          "action": "report",
          "args": {
            "format": "pdf",
            "template": "intake_summary",
            "artifact_path": "./artifacts/intake_reports"
          },
          "timeout": 30000
        }
      ],
      "parallel": true
    }
  ],
  "error_handling": {
    "max_errors": 3,
    "escalation_policy": "after_retries"
  },
  "metadata": {
    "author": "garage-mcp",
    "created_at": "2025-08-19T00:00:00Z",
    "updated_at": "2025-08-19T00:00:00Z",
    "tags": ["client", "intake", "onboarding"]
  }
}