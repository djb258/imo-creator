# Global CTB Configuration
version: "1.0.0"
repository: imo-creator
description: AI-powered IMO (Indexed Marketing Operation) creation and management system

# CTB Structure Configuration
ctb:
  enabled: true
  version: "1.0.0"
  branches:
    - sys      # System integrations and infrastructure
    - ai       # AI models, prompts, and training
    - data     # Database schemas and migrations
    - docs     # Documentation and guides
    - ui       # User interfaces and components
    - meta     # CTB metadata and registry

# Doctrine Enforcement
doctrine_enforcement:
  ctb_factory: ctb/sys/global-factory/
  auto_sync: true
  min_score: 70
  composio_scenario: CTB_Compliance_Cycle
  auto_remediate: true
  audit_frequency: monthly

# Logging Configuration
logging:
  directory: logs/
  audit_enabled: true
  retention_days: 90
  levels:
    - audit
    - error
    - info
    - debug

# Integration Settings
integrations:
  composio:
    enabled: true
    mcp_url: http://localhost:3001/tool
    api_key_env: COMPOSIO_API_KEY
    user_id_env: COMPOSIO_USER_ID
  firebase:
    enabled: true
    config_path: ctb/sys/firebase/firebase.json
  neon:
    enabled: true
    database_url_env: DATABASE_URL
  github:
    enabled: true
    factory_path: ctb/sys/github-factory/

# Workbench Configuration
workbench:
  enabled: true
  module_path: workbench
  duckdb_path: workbench/workbench.duckdb
  b2_keys_required: true
  uses_neon: true
  inherits_env: true
  description: "Workbench: Backblaze B2 + DuckDB integration for enrichment, diffing, and validator deltas."

  # Backblaze B2 Connection Configuration
  backblaze_b2:
    api_version: v2
    api_type: native  # Uses native B2 API (not S3-compatible)
    auth_endpoint: https://api.backblazeb2.com/b2api/v2/b2_authorize_account
    supports_master_key: true
    documentation_url: https://www.backblaze.com/docs/cloud-storage-create-and-manage-app-keys

    # How to get B2 credentials:
    setup_instructions: |
      1. Log into Backblaze B2: https://secure.backblaze.com/b2_buckets.htm
      2. Navigate to "App Keys": https://secure.backblaze.com/app_keys.htm
      3. Create new Application Key or use existing Master Application Key
      4. Copy the following values:
         - keyID: Your Application Key ID (e.g., a98b56408dc7)
         - applicationKey: Your Application Key secret (shown only once!)
         - bucketName: Name of your B2 bucket (e.g., svg-enrichment)
      5. Add to .env file:
         B2_KEY_ID=<your_keyID>
         B2_APPLICATION_KEY=<your_applicationKey>
         B2_BUCKET=<your_bucket_name>
      6. Run: python workbench/bootstrap.py

    # Required permissions for Application Key
    required_permissions:
      - listBuckets
      - listFiles
      - readFiles
      - writeFiles
      - deleteFiles  # optional, for cleanup operations

    # Connection test command
    test_connection: python workbench/bootstrap.py

    # Troubleshooting
    common_issues:
      - issue: "Authorization failed"
        solution: "Verify keyID and applicationKey are correct. Check that key has not expired."
      - issue: "Bucket not found"
        solution: "Verify bucket name matches exactly (case-sensitive). Check key has access to bucket."
      - issue: "File not found"
        solution: "workbench.duckdb will be created if not found in bucket. This is normal for first run."

  # Required Environment Variables
  required_env_vars:
    - B2_KEY_ID
    - B2_APPLICATION_KEY
    - B2_BUCKET
    - POSTGRES_URL  # optional: only needed if using Neon integration
    - VALIDATOR_ENDPOINT  # optional: only needed if using validator deltas

  # Child Repository Inheritance
  inheritance:
    auto_copy_files:
      - workbench/
      - .env.template
    auto_update_dependencies: true
    required_packages:
      - python-dotenv
      - requests
      - duckdb

  # File Structure
  file_structure:
    b2_client: workbench/b2_client.py
    load_duckdb: workbench/load_duckdb.py
    save_duckdb: workbench/save_duckdb.py
    neon_pull: workbench/neon_pull.py
    run_diff: workbench/run_diff.py
    apply_deltas: workbench/apply_deltas.py
    bootstrap: workbench/bootstrap.py

# HEIR/ORBT Configuration
heir_orbt:
  enabled: true
  heir_format: HEIR-YYYY-MM-SYSTEM-MODE-VN
  process_id_format: PRC-SYSTEM-EPOCHTIMESTAMP
  orbt_layers:
    1: Infrastructure
    2: Integration
    3: Application
    4: Presentation
  blueprint_version: "1.0"

# Database Configuration
database:
  providers:
    - firebase
    - neon
  migrations:
    directory: ctb/data/migrations/
    auto_run: false
  schema_validation: true

# AI Configuration
ai:
  providers:
    - gemini
    - openai
  prompts_directory: ctb/ai/prompts/
  models_directory: ctb/ai/models/
  default_provider: gemini

# UI Configuration
ui:
  framework: react
  components_directory: ctb/ui/components/
  pages_directory: ctb/ui/pages/
  styling: tailwind

# Documentation
documentation:
  auto_generate: true
  formats:
    - markdown
    - json
  output_directory: ctb/docs/

# Maintenance
maintenance:
  auto_tag_new_files: true
  monthly_audit: true
  compliance_alerts: true
  alert_threshold: 85

# Security
security:
  env_vars_required:
    - DATABASE_URL
    - COMPOSIO_API_KEY
  secrets_detection: true
  vulnerability_scanning: true

# Performance
performance:
  cache_enabled: true
  cache_ttl: 3600
  compression: true

# Metadata
metadata:
  last_updated: "2025-10-23"
  maintainers:
    - CTB Standards Team
  version_history:
    - version: "1.0.0"
      date: "2025-10-23"
      changes: Initial CTB implementation
