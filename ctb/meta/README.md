# CTB/META - Metadata & Configuration

**Division**: Metadata & Configuration (10k Altitude)
**Purpose**: IDE settings, configs, dependencies, registry data, and project metadata

---

## ðŸ“ Directory Structure

```
ctb/meta/
â”œâ”€â”€ config/                    # Configuration files
â”‚   â”œâ”€â”€ composio_ctb_tasks.json  # CTB compliance tasks
â”‚   â”œâ”€â”€ package.json           # Node.js dependencies
â”‚   â””â”€â”€ package-lock.json      # Locked dependency versions
â”œâ”€â”€ ide/                       # IDE-specific settings
â”‚   â”œâ”€â”€ .vscode/              # VS Code configuration
â”‚   â””â”€â”€ .cursor/              # Cursor IDE settings
â”œâ”€â”€ registry/                  # CTB registry data
â”‚   â”œâ”€â”€ ctb_registry.json     # Generated registry
â”‚   â”œâ”€â”€ audit_data.json       # Audit results
â”‚   â”œâ”€â”€ tagging_data.json     # Metadata tagging data
â”‚   â””â”€â”€ remediation_data.json # Remediation history
â”œâ”€â”€ DEPENDENCIES.md            # Inter-branch dependencies
â””â”€â”€ tests/                     # Meta-level tests
    â””â”€â”€ test_compliance.py    # CTB compliance tests
```

---

## ðŸš€ Quick Start

### 1. View Configuration

```bash
# View Composio CTB tasks
cat ctb/meta/config/composio_ctb_tasks.json

# View CTB registry
cat ctb/meta/registry/ctb_registry.json

# View dependencies
cat ctb/meta/DEPENDENCIES.md
```

### 2. Run Compliance Check

```bash
# Generate audit report
python ctb/sys/github-factory/scripts/ctb_audit_generator.py

# View audit data
cat ctb/meta/registry/audit_data.json
```

### 3. Update Registry

```bash
# Run remediation (auto-generates registry)
python ctb/sys/github-factory/scripts/ctb_remediator.py

# Check registry
cat ctb/meta/registry/ctb_registry.json
```

---

## ðŸ“‹ Configuration Files

### Composio CTB Tasks

**`config/composio_ctb_tasks.json`**

Defines CTB compliance tasks exposed via Composio MCP:

```json
{
  "tasks": [
    {
      "task_id": "ctb_tagger",
      "name": "CTB Metadata Tagger",
      "schedule": "on_demand"
    },
    {
      "task_id": "ctb_auditor",
      "name": "CTB Audit Generator",
      "schedule": "weekly",
      "depends_on": ["ctb_tagger"]
    },
    {
      "task_id": "ctb_remediator",
      "name": "CTB Remediator",
      "schedule": "weekly",
      "depends_on": ["ctb_auditor"]
    }
  ],
  "scenarios": [
    {
      "scenario_id": "CTB_Compliance_Cycle",
      "execution_order": "sequential",
      "schedule": "weekly_monday_00:00_utc",
      "compliance_threshold": 90
    }
  ]
}
```

**Usage**:
- Defines automated compliance workflows
- Exposes scripts as Composio MCP tools
- Configured for weekly compliance cycles

---

## ðŸ—ƒï¸ Registry Data

### CTB Registry

**`registry/ctb_registry.json`**

Auto-generated registry of CTB structure:

```json
{
  "version": "1.3.3",
  "generated": "2025-10-23T...",
  "repository": "imo-creator",
  "divisions": {
    "sys": {
      "path": "ctb/sys",
      "file_count": 150,
      "subdirectories": ["api", "server", "services", "scripts"],
      "status": "active"
    }
  },
  "enforcement": {
    "scripts": [...],
    "workflows": [...],
    "status": "active"
  }
}
```

**Generated by**: `ctb_remediator.py`
**Frequency**: After every remediation run

### Audit Data

**`registry/audit_data.json`**

Complete audit results:

```json
{
  "timestamp": "2025-10-23T...",
  "version": "1.3.3",
  "structure": {...},
  "compliance": {...},
  "issues": [...],
  "recommendations": [...],
  "statistics": {
    "compliance_score": 95
  }
}
```

**Generated by**: `ctb_audit_generator.py`
**Frequency**: Weekly + on-demand

### Tagging Data

**`registry/tagging_data.json`**

Metadata tagging results:

```json
{
  "timestamp": "2025-10-23T...",
  "total_tagged": 150,
  "tagged_files": [
    {
      "path": "ctb/sys/api/composio_tools.py",
      "division": "System Infrastructure",
      "compliance": 95,
      "heir_id": "HEIR-2025-10-CTB-TAG-01"
    }
  ]
}
```

**Generated by**: `ctb_metadata_tagger.py`
**Frequency**: On-demand

---

## ðŸ“Š Dependencies

**`DEPENDENCIES.md`**

Documents all inter-branch and inter-division dependencies.

**Key Sections**:
1. **Division Dependencies**: Which divisions depend on each other
2. **External Dependencies**: Third-party services and APIs
3. **Internal Dependencies**: Shared libraries and utilities
4. **Deployment Dependencies**: Required for production

**Format**:
```markdown
## Division: CTB/SYS

**Depends On**: None (foundation layer)
**Used By**: ctb/ai/, ctb/data/, ctb/ui/

## Division: CTB/AI

**Depends On**: ctb/sys/ (MCP server, APIs)
**Used By**: ctb/ui/ (agent orchestration)
```

---

## ðŸ”§ IDE Configuration

### VS Code Settings

**`ide/.vscode/settings.json`**

Project-specific VS Code configuration:
- Python path configuration
- Linting rules
- Formatting settings
- Extension recommendations

### Cursor Settings

**`ide/.cursor/settings.local.json`**

Cursor IDE specific settings:
- AI assistant configuration
- Code completion preferences
- Custom shortcuts

---

## ðŸ“ˆ CTB Compliance Workflow

### 1. Metadata Tagging

```bash
# Tag all files with CTB metadata
python ctb/sys/github-factory/scripts/ctb_metadata_tagger.py

# Output: CTB_TAGGING_REPORT.md
# Data: ctb/meta/registry/tagging_data.json
```

### 2. Audit Generation

```bash
# Generate compliance audit
python ctb/sys/github-factory/scripts/ctb_audit_generator.py

# Output: CTB_AUDIT_REPORT.md
# Data: ctb/meta/registry/audit_data.json
```

### 3. Remediation

```bash
# Auto-fix compliance issues
python ctb/sys/github-factory/scripts/ctb_remediator.py

# Output: CTB_REMEDIATION_SUMMARY.md
# Data: ctb/meta/registry/remediation_data.json
# Registry: ctb/meta/registry/ctb_registry.json
```

### 4. Review Results

```bash
# Check compliance score
cat CTB_AUDIT_REPORT.md | grep "Compliance Score"

# View issues
cat CTB_AUDIT_REPORT.md | grep -A 20 "## Issues"

# Check registry status
cat ctb/meta/registry/ctb_registry.json | jq '.enforcement.status'
```

---

## ðŸ§ª Compliance Testing

### Test CTB Structure

**`tests/test_compliance.py`**

```python
import pytest
from pathlib import Path

def test_required_divisions_exist():
    """Test all required CTB divisions exist"""
    ctb_root = Path('ctb')
    required = ['sys', 'ai', 'data', 'docs', 'ui', 'meta']

    for division in required:
        assert (ctb_root / division).exists()

def test_compliance_score():
    """Test compliance score meets minimum threshold"""
    import json
    audit_data = json.loads(
        Path('ctb/meta/registry/audit_data.json').read_text()
    )

    score = audit_data['statistics']['compliance_score']
    assert score >= 90, f"Compliance score {score}% below minimum 90%"
```

**Run Tests**:
```bash
pytest ctb/meta/tests/test_compliance.py
```

---

## ðŸ“š Configuration Reference

### Package Configuration

**`config/package.json`**

Node.js dependencies for MCP servers and tools:

```json
{
  "name": "imo-creator-ctb",
  "version": "1.3.3",
  "dependencies": {
    "composio-core": "^6.0.0",
    "@modelcontextprotocol/sdk": "^1.0.0"
  }
}
```

**Install Dependencies**:
```bash
cd ctb/meta/config
npm install
```

### Environment Configuration

Environment variables are documented in:
- `ctb/sys/api/.env.example` - API configuration
- `ctb/data/.env.example` - Database configuration

**DO NOT** store actual `.env` files in the repository.
**USE** MCP Vault or environment-specific secrets management.

---

## ðŸ” Registry Queries

### Using jq (JSON Query)

```bash
# Get compliance score
jq '.statistics.compliance_score' ctb/meta/registry/audit_data.json

# List all divisions
jq '.divisions | keys' ctb/meta/registry/ctb_registry.json

# Count total files
jq '.metadata.total_files' ctb/meta/registry/audit_data.json

# Get critical issues
jq '.issues[] | select(.severity == "critical")' ctb/meta/registry/audit_data.json

# List tagged files
jq '.tagged_files[].path' ctb/meta/registry/tagging_data.json
```

### Using Python

```python
import json
from pathlib import Path

# Load registry
registry = json.loads(
    Path('ctb/meta/registry/ctb_registry.json').read_text()
)

# Get division info
for name, data in registry['divisions'].items():
    print(f"{name}: {data['file_count']} files")

# Load audit data
audit = json.loads(
    Path('ctb/meta/registry/audit_data.json').read_text()
)

print(f"Compliance Score: {audit['statistics']['compliance_score']}%")
```

---

## ðŸš¨ Critical Rules

### DO NOT Commit

âŒ `.env` files (use `.env.example`)
âŒ Secrets or API keys
âŒ Personal IDE settings (use workspace settings)
âŒ Large binary registry files (>10MB)

### ALWAYS Commit

âœ… Configuration templates (`.env.example`)
âœ… Registry JSON files (generated data)
âœ… Compliance reports (audit, tagging, remediation)
âœ… Dependencies documentation

### Version Control

- Registry files are auto-generated but **should be committed**
- They provide historical compliance tracking
- Use `.gitignore` for personal IDE settings only

---

## ðŸ”— Related Documentation

### Internal

- **CTB Doctrine**: `ctb/sys/global-factory/CTB_DOCTRINE.md`
- **Global Manifest**: `ctb/sys/global-factory/global_manifest.yaml`
- **Global Config**: `ctb/sys/global-factory/global-config.yaml`
- **Entry Point**: `ENTRYPOINT.md` (root)

### External

- **Composio Docs**: https://docs.composio.dev
- **MCP Specification**: https://modelcontextprotocol.io
- **JSON Schema**: https://json-schema.org

---

## ðŸ“Š Compliance Metrics

### Key Performance Indicators

**Target Metrics**:
- Compliance Score: â‰¥ 90%
- Critical Issues: 0
- High Issues: < 5
- Tagged Files: 100%

**Current Status**:
```bash
# Check current compliance
jq '{
  score: .statistics.compliance_score,
  issues: .statistics.total_issues,
  recommendations: .statistics.total_recommendations
}' ctb/meta/registry/audit_data.json
```

### Tracking Over Time

```bash
# Save audit history
cp ctb/meta/registry/audit_data.json \
   ctb/meta/registry/audit_history/$(date +%Y-%m-%d).json

# Compare compliance over time
for file in ctb/meta/registry/audit_history/*.json; do
  date=$(basename $file .json)
  score=$(jq '.statistics.compliance_score' $file)
  echo "$date: $score%"
done
```

---

## ðŸ› ï¸ Maintenance Tasks

### Weekly Tasks

1. Run CTB Compliance Cycle:
   ```bash
   python ctb/sys/github-factory/scripts/ctb_metadata_tagger.py
   python ctb/sys/github-factory/scripts/ctb_audit_generator.py
   python ctb/sys/github-factory/scripts/ctb_remediator.py
   ```

2. Review compliance reports
3. Address critical issues
4. Update dependencies if needed

### Monthly Tasks

1. Update `DEPENDENCIES.md` with new dependencies
2. Review and prune old registry data
3. Update IDE configurations for team
4. Audit third-party package versions

---

## ðŸ”„ Automated Workflows

### GitHub Actions

**`.github/workflows/ctb_enforcement.yml`**

Automated compliance checks on every push:
- Runs CTB audit
- Checks compliance score
- Blocks merge if score < 90%
- Posts results as PR comment

**Trigger**:
- On push to any branch
- On pull request
- Weekly schedule (Monday 00:00 UTC)

### Composio MCP Integration

**Task**: `CTB_Compliance_Cycle`

Weekly automated execution:
1. Tag all new/modified files
2. Generate comprehensive audit
3. Auto-remediate issues
4. Update registry
5. Send notifications

**Schedule**: Weekly, Monday 00:00 UTC
**Threshold**: 90% minimum compliance

---

**Last Updated**: 2025-10-23
**CTB Version**: 1.3.3
**Maintainer**: Meta Configuration Team
